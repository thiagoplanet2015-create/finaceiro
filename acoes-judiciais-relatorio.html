<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A√ß√µes Judiciais - Relat√≥rio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
  :root{
    --brand:#72bf44;
    --brand-600:#5fa535;
    --brand-light:#9fc612;
    --ink:#0f172a;
    --muted:#64748b;
    --paper:#ffffff;
    --bg:#f3f6fb;
    --success:#72bf44;
    --danger:#e11d48;
    --border:#e5e7eb;
    --table-stripe:#fafbff;
  }

  body{ background:var(--bg); color:var(--ink); }
  h1,h2,h3,h4,h5 { color:var(--ink); letter-spacing:.2px; }

  .topbar{
    background: linear-gradient(135deg, var(--brand) 0%, var(--brand-600) 100%);
    color: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .topbar .fw-bold{ color: #fff; font-size: 1.2rem; }
  .topbar .text-muted{ color: rgba(255,255,255,0.85) !important; }

  .card{
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(2,6,23,.05);
  }
  .card-header{
    background:linear-gradient(180deg,#f8fdf5, #e8f5e0);
    border-bottom:1px solid var(--border);
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .card-header h5{ color: var(--brand-600); font-weight: 700; }

  .info-row{
    display: flex;
    padding: 0.6rem 0;
    border-bottom: 1px solid #f0f0f0;
  }
  .info-row:last-child{ border-bottom: none; }
  .info-label{
    font-weight: 600;
    color: var(--muted);
    min-width: 220px;
  }
  .info-value{
    color: var(--ink);
    font-weight: 500;
  }

  .btn-primary{
    background:var(--brand); border-color:var(--brand);
    border-radius:10px; font-weight:600;
  }
  .btn-primary:hover{ 
    background:var(--brand-600); 
    border-color:var(--brand-600);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(114, 191, 68, 0.3);
  }
  .btn-outline-secondary{ border-radius:10px; font-weight:600; }

  .table{
    --bs-table-striped-bg: var(--table-stripe);
    border-color: var(--border);
  }
  .table thead th{
    position:sticky; top:0; background:#e8f5e0; z-index:2;
    border-bottom:2px solid var(--brand); color:var(--brand-600); font-weight:700;
    font-size: 0.85rem;
  }
  .table>tbody>tr>td, .table>thead>tr>th{ vertical-align: middle; }
  .table-sm td, .table-sm th{ padding:.55rem .6rem; font-size: 0.9rem; }

  .totals-card{
    border:1px dashed #d0ecc0; border-radius:10px; padding:.75rem 1rem;
    background:#f8fdf5;
  }
  .totals-card .label{ color:var(--muted); font-weight: 600; }
  .totals-card .value{ font-weight:700; font-size: 1.1rem; }
  .totals-card .value.success{ color:var(--success); }

  .badge-status{
    padding: 0.4rem 0.8rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.85rem;
  }
  .badge-aprovado{
    background: #d1fae5;
    color: #065f46;
  }
  .badge-rejeitado{
    background: #fee2e2;
    color: #991b1b;
  }
  .badge-pendente{
    background: #fef3c7;
    color: #92400e;
  }

  @media print {
    .no-print { display: none !important; }
    body { background: white; }
    .card { box-shadow: none; page-break-inside: avoid; }
  }
</style>
</head>
<body>
  <nav class="topbar no-print">
    <div class="container py-2 d-flex align-items-center justify-content-between">
      <div class="fw-bold">Portal Financeiro - A√ß√µes Judiciais</div>
      <div class="text-muted small">
        Empresa: <span id="empresaSpan">-</span> ‚Ä¢ Usu√°rio: <span id="usuarioSpan">-</span>
      </div>
    </div>
  </nav>

  <div class="container my-4">
    <div class="d-flex align-items-center justify-content-between mb-3 no-print">
      <h4 class="mb-0">Relat√≥rio Final - A√ß√£o Judicial</h4>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">üñ® Imprimir</button>
        <a href="dashboard.html" class="btn btn-outline-secondary btn-sm">‚Üê Voltar ao Dashboard</a>
      </div>
    </div>

    <!-- Status da An√°lise -->
    <div class="card mb-4">
      <div class="card-body text-center">
        <h5 class="mb-3">Status da An√°lise</h5>
        <div id="statusBadge"></div>
        <p class="text-muted mt-2 mb-0">An√°lise realizada por: <strong id="analistaInfo">-</strong></p>
        <p class="text-muted mb-0">Data: <strong id="dataAnaliseInfo">-</strong></p>
      </div>
    </div>

    <!-- Dados do Pagamento -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Dados do Pagamento</h5>
      </div>
      <div class="card-body">
        <div class="info-row">
          <div class="info-label">Empresa:</div>
          <div class="info-value" id="infoEmpresa">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Tipo de Nota:</div>
          <div class="info-value" id="infoTipoNota">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Fornecedor:</div>
          <div class="info-value" id="infoFornecedor">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Nr do Fornecedor:</div>
          <div class="info-value" id="infoNrFornecedor">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Nome local do Fornecedor:</div>
          <div class="info-value" id="infoNomeLocalFornecedor">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Data da Emiss√£o da NF:</div>
          <div class="info-value" id="infoDataEmissaoNF">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Quantia:</div>
          <div class="info-value" id="infoQuantia">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Processo:</div>
          <div class="info-value" id="infoProcesso">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Pasta:</div>
          <div class="info-value" id="infoPasta">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Reclamante:</div>
          <div class="info-value" id="infoReclamante">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Descri√ß√£o:</div>
          <div class="info-value" id="infoDescricao">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Moeda:</div>
          <div class="info-value" id="infoMoeda">BRL</div>
        </div>
      </div>
    </div>

    <!-- Benefici√°rios -->
    <div class="card mb-4" id="cardBeneficiarios" style="display:none;">
      <div class="card-header">
        <h5 class="mb-0">Benefici√°rios</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Nome</th>
                <th>CPF</th>
                <th>Banco</th>
                <th>Ag√™ncia</th>
                <th>Tipo Conta</th>
                <th>N¬∫ Conta</th>
                <th>Valor</th>
                <th>Descri√ß√£o</th>
                <th>Chave Cont√°bil</th>
                <th>Data Pagamento</th>
              </tr>
            </thead>
            <tbody id="tabelaBeneficiarios"></tbody>
          </table>
        </div>
        <div class="totals-card mt-3">
          <div class="d-flex justify-content-between">
            <span class="label">Total Benefici√°rios:</span>
            <span class="value success" id="totalBeneficiarios">R$ 0,00</span>
          </div>
        </div>
      </div>
    </div>

    <!-- INSS/Impostos -->
    <div class="card mb-4" id="cardImpostos" style="display:none;">
      <div class="card-header">
        <h5 class="mb-0">INSS / Impostos</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Valor</th>
                <th>Descri√ß√£o</th>
                <th>Tipo</th>
                <th>Chave Cont√°bil</th>
              </tr>
            </thead>
            <tbody id="tabelaImpostos"></tbody>
          </table>
        </div>
        <div class="totals-card mt-3">
          <div class="d-flex justify-content-between">
            <span class="label">Total INSS/Impostos:</span>
            <span class="value success" id="totalImpostos">R$ 0,00</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Geral -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="totals-card">
          <div class="d-flex justify-content-between">
            <span class="label" style="font-size: 1.2rem;">Total Geral:</span>
            <span class="value success" id="totalGeral" style="font-size: 1.4rem;">R$ 0,00</span>
          </div>
        </div>
      </div>
    </div>

    <!-- An√°lise do Processo -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">An√°lise do Processo</h5>
      </div>
      <div class="card-body">
        <div class="info-row">
          <div class="info-label">Centro de Custo:</div>
          <div class="info-value" id="infoCentroCusto">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Conta Cont√°bil:</div>
          <div class="info-value" id="infoContaContabil">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Categoria:</div>
          <div class="info-value" id="infoCategoria">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Observa√ß√µes:</div>
          <div class="info-value" id="infoObservacoes">-</div>
        </div>
      </div>
    </div>

    <!-- Dados do Anexo -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Dados do Anexo</h5>
      </div>
      <div class="card-body">
        <div class="info-row">
          <div class="info-label">Data da Emiss√£o da NF:</div>
          <div class="info-value" id="infoDataEmissaoNFAnexo">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">N¬∫ da NFF/C.I:</div>
          <div class="info-value" id="infoNumeroNFF">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Quantia da NFF/C.I:</div>
          <div class="info-value" id="infoQuantiaNFF">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Data GL:</div>
          <div class="info-value" id="infoDataGL">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Data Taxa Pagto:</div>
          <div class="info-value" id="infoDataTaxaPagto">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Vincular A√ß√£o:</div>
          <div class="info-value" id="infoVincularAcao">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Data das Condi√ß√µes:</div>
          <div class="info-value" id="infoDataCondicoes">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Condi√ß√µes:</div>
          <div class="info-value" id="infoCondicoes">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">M√©todo de Pagamento:</div>
          <div class="info-value" id="infoMetodoPagamento">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Grupo de Pagamento:</div>
          <div class="info-value" id="infoGrupoPagamento">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Chave Cont√°bil:</div>
          <div class="info-value" id="infoChaveContabilAnexo">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">Moeda de Pagto:</div>
          <div class="info-value" id="infoChaveContabilAnexo">BRL</div>
        </div>
        <div class="info-row">
          <div class="info-label">Pa√≠s:</div>
          <div class="info-value" id="infoChaveContabilAnexo">Brasil</div>
        </div>
      </div>
    </div>

    <!-- Bot√µes -->
    <div class="d-flex gap-2 no-print">
      <button class="btn btn-outline-secondary flex-fill" onclick="window.location.href='dashboard.html'">
        ‚Üê Voltar ao Dashboard
      </button>
      <button class="btn btn-primary flex-fill" onclick="window.print()">
        üñ® Imprimir Relat√≥rio
      </button>
    </div>
  </div>

  <script>
  const empresa = sessionStorage.getItem('empresa');
  const usuario = sessionStorage.getItem('usuario');
  document.getElementById('empresaSpan').textContent = empresa || '-';
  document.getElementById('usuarioSpan').textContent = usuario || '-';

  // Carrega dados do sessionStorage
  const dadosJSON = sessionStorage.getItem('dadosAcaoJudicial');
  if (!dadosJSON) {
    alert('Nenhum dado encontrado. Redirecionando...');
    window.location.href = 'acoes-judiciais.html';
  }

  const dados = JSON.parse(dadosJSON);

  // Status da an√°lise
  if (dados.analise) {
    const status = dados.analise.statusAnalise;
    let badgeClass = 'badge-pendente';
    if (status === 'Aprovado') badgeClass = 'badge-aprovado';
    if (status === 'Rejeitado') badgeClass = 'badge-rejeitado';

    document.getElementById('statusBadge').innerHTML = 
      `<span class="badge-status ${badgeClass}">${status}</span>`;
    document.getElementById('analistaInfo').textContent = dados.analise.analista || '-';
    document.getElementById('dataAnaliseInfo').textContent = dados.analise.dataAnalise ? 
      new Date(dados.analise.dataAnalise).toLocaleString('pt-BR') : '-';
  }

  // Preenche dados do pagamento
  document.getElementById('infoEmpresa').textContent = dados.empresa || '-';
  document.getElementById('infoTipoNota').textContent = dados.tipoNota || 'Padr√£o';
  document.getElementById('infoFornecedor').textContent = dados.fornecedor || '-';
  document.getElementById('infoNrFornecedor').textContent = dados.nrFornecedor || '-';
  document.getElementById('infoNomeLocalFornecedor').textContent = dados.nomeLocalFornecedor || '-';
  document.getElementById('infoDataEmissaoNF').textContent = dados.dataEmissaoNF ? 
    new Date(dados.dataEmissaoNF + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
  document.getElementById('infoQuantia').textContent = dados.quantia ? `R$ ${dados.quantia}` : '-';
  document.getElementById('infoProcesso').textContent = dados.processo || '-';
  document.getElementById('infoPasta').textContent = dados.pasta || '-';
  document.getElementById('infoReclamante').textContent = dados.reclamante || '-';
  document.getElementById('infoDescricao').textContent = dados.descricaoItem || '-';

  let totalGeral = 0;

  // Renderiza benefici√°rios
  if (dados.beneficiarios && dados.beneficiarios.length > 0) {
    document.getElementById('cardBeneficiarios').style.display = 'block';
    const tbody = document.getElementById('tabelaBeneficiarios');
    let total = 0;

    dados.beneficiarios.forEach(b => {
      const valorNum = parseFloat(b.valor.replace(',', '.')) || 0;
      total += valorNum;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${b.nome}</td>
        <td>${b.cpf}</td>
        <td>${b.banco}</td>
        <td>${b.agencia || '-'}</td>
        <td>${b.tipoConta}</td>
        <td>${b.numeroConta}</td>
        <td>R$ ${b.valor}</td>
        <td>${b.descricao || '-'}</td>
        <td>${b.chaveContabil || '-'}</td>
        <td>${b.dataPagamento ? new Date(b.dataPagamento + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById('totalBeneficiarios').textContent = 
      `R$ ${total.toFixed(2).replace('.', ',')}`;
    totalGeral += total;
  }

  // Renderiza INSS/Impostos
  if (dados.impostos && dados.impostos.length > 0) {
    document.getElementById('cardImpostos').style.display = 'block';
    const tbody = document.getElementById('tabelaImpostos');
    let total = 0;

    dados.impostos.forEach(imp => {
      const valorNum = parseFloat(imp.valor.replace(',', '.')) || 0;
      total += valorNum;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>R$ ${imp.valor}</td>
        <td>${imp.descricao}</td>
        <td><span class="badge bg-info">${imp.tipo}</span></td>
        <td>${imp.chaveContabil || '-'}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById('totalImpostos').textContent = 
      `R$ ${total.toFixed(2).replace('.', ',')}`;
    totalGeral += total;
  }

  // Total Geral
  document.getElementById('totalGeral').textContent = 
    `R$ ${totalGeral.toFixed(2).replace('.', ',')}`;

  // An√°lise do Processo
  if (dados.analise) {
    document.getElementById('infoCentroCusto').textContent = dados.analise.centroCusto || '-';
    document.getElementById('infoContaContabil').textContent = dados.analise.contaContabil || '-';
    document.getElementById('infoCategoria').textContent = dados.analise.categoria || '-';
    document.getElementById('infoObservacoes').textContent = dados.analise.observacoes || '-';

    // Dados do Anexo
    document.getElementById('infoDataEmissaoNFAnexo').textContent = dados.analise.dataEmissaoNF ? 
      new Date(dados.analise.dataEmissaoNF + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
    document.getElementById('infoNumeroNFF').textContent = dados.analise.numeroNFF || '-';
    document.getElementById('infoQuantiaNFF').textContent = dados.analise.quantiaNFF ? 
      `R$ ${dados.analise.quantiaNFF}` : '-';
    document.getElementById('infoDataGL').textContent = dados.analise.dataGL ? 
      new Date(dados.analise.dataGL + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
    document.getElementById('infoDataTaxaPagto').textContent = dados.analise.dataTaxaPagto ? 
      new Date(dados.analise.dataTaxaPagto + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
    document.getElementById('infoVincularAcao').textContent = dados.analise.vincularAcao || '-';
    document.getElementById('infoDataCondicoes').textContent = dados.analise.dataCondicoes ? 
      new Date(dados.analise.dataCondicoes + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
    document.getElementById('infoCondicoes').textContent = dados.analise.condicoes || '-';
    document.getElementById('infoMetodoPagamento').textContent = dados.analise.metodoPagamento || '-';
    document.getElementById('infoGrupoPagamento').textContent = dados.analise.grupoPagamento || '-';
    document.getElementById('infoChaveContabilAnexo').textContent = dados.analise.chaveContabilAnexo || '-';
  }
</script>
</body>
</html>