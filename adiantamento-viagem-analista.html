<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analista - Solicitação de Adiantamento Viagem</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { padding: 1rem; background: #f3f6fb; color: #0f172a; }
    .table-hover tbody tr:hover { background-color: #e0e7ff; cursor: pointer; }
    .form-control[readonly] { background-color: #e9ecef; }
  </style>
</head>
<body>
  <div class="container my-4">
    <h3>Itens para Análise</h3>
    <table class="table table-hover" id="tabelaItens">
      <thead>
        <tr><th>Empresa</th><th>Nome</th><th>Valor (R$)</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Detalhes do Item Selecionado</h3>
    <form id="formAnalise" class="row g-3">
      <div class="col-md-6">
        <label for="empresa" class="form-label">Empresa</label>
        <input type="text" id="empresa" class="form-control" readonly />
      </div>
      <div class="col-md-6">
        <label for="nome" class="form-label">Nome completo</label>
        <input type="text" id="nome" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="rg" class="form-label">RG</label>
        <input type="text" id="rg" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="cpf" class="form-label">CPF</label>
        <input type="text" id="cpf" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="nff" class="form-label">Nº da NFF/C.I:</label>
        <input type="text" id="nff" class="form-control" />
      </div>
      <div class="col-md-6">
        <label for="nacionalidade" class="form-label">Nacionalidade</label>
        <input type="text" id="nacionalidade" class="form-control" readonly />
      </div>
      <div class="col-md-6">
        <label for="endereco" class="form-label">Endereço completo</label>
        <input type="text" id="endereco" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="banco" class="form-label">Banco</label>
        <input type="text" id="banco" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="agencia" class="form-label">Agência</label>
        <input type="text" id="agencia" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="conta" class="form-label">Conta</label>
        <input type="text" id="conta" class="form-control" readonly />
      </div>
      <div class="col-md-6">
        <label for="valor" class="form-label">Valor (R$)</label>
        <input type="number" step="0.01" id="valor" class="form-control" readonly />
      </div>
      <div class="col-md-6">
        <label for="dataDeposito" class="form-label">Data do depósito</label>
        <input type="date" id="dataDeposito" class="form-control" readonly />
      </div>
      <div class="col-12">
        <label for="motivo" class="form-label">Motivo / Descrição da viagem</label>
        <textarea id="motivo" class="form-control" rows="2" readonly></textarea>
      </div>
      <div class="col-md-6">
        <label for="local" class="form-label">Cidade/Estado</label>
        <input type="text" id="local" class="form-control" readonly />
      </div>
      <div class="col-md-6">
        <label for="dataRecibo" class="form-label">Data do Recibo</label>
        <input type="date" id="dataRecibo" class="form-control" readonly />
      </div>

      <hr class="my-3" />

      <div class="col-md-6">
        <label for="statusAnalise" class="form-label text-danger">Status da Análise</label>
        <select id="statusAnalise" class="form-select" required>
          <option value="">Selecione</option>
          <option value="Aprovado">Aprovado</option>
          <option value="Rejeitado">Rejeitado</option>
          <option value="Pendente">Pendente</option>
        </select>
      </div>
      <div class="col-md-6">
        <label for="observacoes" class="form-label text-danger">Observações</label>
        <textarea id="observacoes" class="form-control" rows="3" placeholder="Observações do analista"></textarea>
      </div>

      <div class="col-12">
        <button class="btn btn-primary" type="submit">Salvar Análise</button>
      </div>
    </form>
  </div>

<script>
  let registros = JSON.parse(sessionStorage.getItem('adiantamentoViagemItens') || '[]');
  const tbody = document.querySelector('#tabelaItens tbody');
  let selecionadoIndex = null;

  function preencherFormulario(item) {
    document.getElementById('empresa').value = item.empresa || '';
    document.getElementById('nome').value = item.nome || '';
    document.getElementById('rg').value = item.rg || '';
    document.getElementById('cpf').value = item.cpf || '';
    document.getElementById('nff').value = item.nff || '';
    document.getElementById('nacionalidade').value = item.nacionalidade || '';
    document.getElementById('endereco').value = item.endereco || '';
    document.getElementById('banco').value = item.banco || '';
    document.getElementById('agencia').value = item.agencia || '';
    document.getElementById('conta').value = item.conta || '';
    document.getElementById('valor').value = item.valor || '';
    document.getElementById('dataDeposito').value = item.dataDeposito || '';
    document.getElementById('motivo').value = item.motivo || '';
    document.getElementById('local').value = item.local || '';
    document.getElementById('dataRecibo').value = item.dataRecibo || '';
    document.getElementById('statusAnalise').value = item.analise?.statusAnalise || '';
    document.getElementById('observacoes').value = item.analise?.observacoes || '';
  }

  function renderTabela() {
    tbody.innerHTML = '';
    registros.forEach((item, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${item.empresa}</td><td>${item.nome}</td><td>${Number(item.valor).toFixed(2)}</td>`;
      tr.style.cursor = 'pointer';
      tr.onclick = () => {
        selecionadoIndex = idx;
        preencherFormulario(item);
      };
      tbody.appendChild(tr);
    });
  }

  document.getElementById('formAnalise').addEventListener('submit', e => {
    e.preventDefault();
    if (selecionadoIndex === null) {
      alert('Selecione um item para analisar.');
      return;
    }
    // Atualiza o campo nff no objeto
    registros[selecionadoIndex].nff = document.getElementById('nff').value.trim();
    registros[selecionadoIndex].analise = {
      statusAnalise: document.getElementById('statusAnalise').value,
      observacoes: document.getElementById('observacoes').value
    };
    sessionStorage.setItem('adiantamentoViagemItens', JSON.stringify(registros));
    alert('Análise salva com sucesso!');
  });

  renderTabela();
</script>
</body>
</html>