<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ações Judiciais – Lançamento Cliente</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      --brand: #2563eb;
      --brand-600: #1d4ed8;
      --ink: #0f172a;
      --muted: #64748b;
      --bg: #f3f6fb;
      --border: #e5e7eb;
      --success: #16a34a;
      --danger: #e11d48;
      --table-stripe: #fafbff;
    }
    body {
      background: var(--bg);
      color: var(--ink);
      padding: 1rem;
    }
    .chip {
      padding: .25rem .6rem;
      border-radius: 999px;
      font-size: .78rem;
      font-weight: 600;
      background: #eef2ff;
      color: var(--brand);
      border: 1px solid #e0e7ff;
    }
    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(2, 6, 23, .05);
    }
    .form-label {
      font-weight: 600;
      color: #334155;
    }
    .form-control,
    .form-select {
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    .form-control:focus,
    .form-select:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 .2rem rgba(37, 99, 235, .15);
    }
    .btn-primary {
      background: var(--brand);
      border-color: var(--brand);
      border-radius: 10px;
      font-weight: 600;
    }
    .btn-primary:hover {
      background: var(--brand-600);
      border-color: var(--brand-600);
    }
    .btn-outline-primary {
      border-radius: 10px;
      font-weight: 600;
      color: var(--brand);
      border-color: var(--brand);
    }
    .btn-outline-primary:hover {
      background: var(--brand);
      color: #fff;
    }
    .table {
      --bs-table-striped-bg: var(--table-stripe);
      border-color: var(--border);
    }
    .table thead th {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2;
      border-bottom: 2px solid var(--border);
      color: #475569;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Ações Judiciais – Lançamento Cliente</h4>
      <div class="d-flex gap-2 text-muted small">
        <span class="chip">Empresa: <strong id="empresaSpan">-</strong></span>
        <span class="chip">Usuário: <strong id="usuarioSpan">-</strong></span>
      </div>
    </div>

    <div class="card p-4 mb-4">
      <form id="formCliente" novalidate>
        <h5 class="mb-3">Adicionar item de pagamento</h5>

        <div class="mb-3">
          <label for="empresa" class="form-label">Empresa</label>
          <select id="empresa" class="form-select" required>
            <option value="">Selecione</option>
            <option>Empresa AGT</option>
            <option>Empresa B</option>
            <option>Empresa C</option>
          </select>
          <div class="invalid-feedback">Selecione a empresa.</div>
        </div>

        <div class="mb-3">
          <label for="tipoNota" class="form-label">Tipo de Nota</label>
          <select id="tipoNota" class="form-select" required>
            <option value="">Selecione</option>
            <option value="Padrão" selected>Padrão</option>
            <option value="Especial">Especial</option>
            <option value="Outro">Outro</option>
          </select>
          <div class="invalid-feedback">Selecione o tipo de nota.</div>
        </div>

        <div class="mb-3">
          <label for="fornecedor" class="form-label">Fornecedor</label>
          <input id="fornecedor" class="form-control" placeholder="Nome do fornecedor" required />
          <div class="invalid-feedback">Informe o fornecedor.</div>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <label for="nrFornecedor" class="form-label">Nr do Fornecedor</label>
            <input id="nrFornecedor" class="form-control" placeholder="xxxxx" required />
            <div class="invalid-feedback">Informe o nº do fornecedor.</div>
          </div>
          <div class="col-md-6">
            <label for="nomeLocalFornecedor" class="form-label">Nome local do Fornecedor</label>
            <input id="nomeLocalFornecedor" class="form-control" placeholder="000144" required />
            <div class="invalid-feedback">Informe o nome do local.</div>
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-md-6">
            <label for="dataEmissaoNF" class="form-label">Data da Emissão da NF</label>
            <input type="date" id="dataEmissaoNF" class="form-control" required />
            <div class="invalid-feedback">Informe a data da emissão.</div>
          </div>
          <div class="col-md-6">
            <label for="quantia" class="form-label">Quantia (R$)</label>
            <input type="number" step="0.01" id="quantia" class="form-control text-end" placeholder="0,00" required />
            <div class="invalid-feedback">Informe a quantia.</div>
          </div>
        </div>

        <div class="d-flex gap-2 mt-4">
          <button class="btn btn-primary" type="submit">Adicionar item</button>
          <button class="btn btn-outline-primary ms-auto" type="button" id="btnProximo">Próximo &raquo;</button>
        </div>
      </form>
    </div>

    <div class="card p-3">
      <h5>Itens adicionados</h5>
      <div style="max-height: 300px; overflow-y: auto;">
        <table class="table table-sm table-hover align-middle" id="tabelaItens">
          <thead>
            <tr>
              <th>Empresa</th>
              <th>Tipo Nota</th>
              <th>Fornecedor</th>
              <th>Nr Forn.</th>
              <th>Nome local</th>
              <th>Data NF</th>
              <th>Quantia</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th colspan="6" class="text-end">Total:</th>
              <th id="totalItens" class="text-end">R$ 0,00</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Contexto do login (exemplo)
    const empresaCtx = sessionStorage.getItem('empresa') || 'Empresa A';
    const usuarioCtx = sessionStorage.getItem('usuario') || 'usuario@exemplo.com';
    document.getElementById('empresaSpan').textContent = empresaCtx;
    document.getElementById('usuarioSpan').textContent = usuarioCtx;

    // Estado dos itens
    let itens = [];

    // Formatação moeda BRL
    const brMoney = v => Number(v || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const fmtDate = v => v ? new Date(v).toLocaleDateString('pt-BR') : '__/__/____';

    // Renderizar tabela
    function renderTabela() {
      const tbody = document.querySelector('#tabelaItens tbody');
      tbody.innerHTML = '';
      itens.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.empresa}</td>
          <td>${item.tipoNota}</td>
          <td>${item.fornecedor}</td>
          <td>${item.nrFornecedor}</td>
          <td>${item.nomeLocalFornecedor}</td>
          <td>${fmtDate(item.dataEmissaoNF)}</td>
          <td class="text-end">${brMoney(item.quantia)}</td>
          <td class="text-end"><button class="btn btn-sm btn-outline-danger" onclick="removerItem('${item.id}')">Remover</button></td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById('totalItens').textContent = brMoney(itens.reduce((a, c) => a + (Number(c.quantia) || 0), 0));
    }

    // Limpar campos do formulário
    function limparCampos() {
      ['tipoNota', 'fornecedor', 'nrFornecedor', 'nomeLocalFornecedor', 'dataEmissaoNF', 'quantia'].forEach(id => {
        const el = document.getElementById(id);
        if (id === 'tipoNota') el.value = 'Padrão';
        else el.value = '';
        el.classList.remove('is-invalid');
      });
    }

    // Validar campos obrigatórios
    function validarCampos() {
      const camposObrigatorios = ['empresa', 'tipoNota', 'fornecedor', 'nrFornecedor', 'nomeLocalFornecedor', 'dataEmissaoNF', 'quantia'];
      let valido = true;
      camposObrigatorios.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value || (id === 'quantia' && Number(el.value) <= 0)) {
          el.classList.add('is-invalid');
          valido = false;
        } else {
          el.classList.remove('is-invalid');
        }
      });
      return valido;
    }

    // Adicionar item
    document.getElementById('formCliente').addEventListener('submit', e => {
      e.preventDefault();
      if (!validarCampos()) return;

      const novoItem = {
        id: crypto.randomUUID(),
        empresa: document.getElementById('empresa').value,
        tipoNota: document.getElementById('tipoNota').value,
        fornecedor: document.getElementById('fornecedor').value.trim(),
        nrFornecedor: document.getElementById('nrFornecedor').value.trim(),
        nomeLocalFornecedor: document.getElementById('nomeLocalFornecedor').value.trim(),
        dataEmissaoNF: document.getElementById('dataEmissaoNF').value,
        quantia: Number(document.getElementById('quantia').value)
      };

      itens.push(novoItem);
      renderTabela();
      limparCampos();
    });

    // Remover item
    window.removerItem = function(id) {
      itens = itens.filter(item => item.id !== id);
      renderTabela();
    };

    // Botão Próximo: salvar no sessionStorage e ir para analista
    document.getElementById('btnProximo').addEventListener('click', () => {
      if (itens.length === 0) {
        alert('Adicione pelo menos um item antes de continuar.');
        return;
      }
      sessionStorage.setItem('acoesJudiciaisItens', JSON.stringify(itens));
      window.location.href = 'acoes-judiciais-analista.html';
    });

    // Inicialização
    renderTabela();
  </script>
</body>
</html>